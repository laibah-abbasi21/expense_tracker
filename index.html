<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    main {
    flex: 1;
}
    body {
      scroll-behavior: smooth;
      background-color: #f8f9fa;
    }
    body {
    height: 100%;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
    nav {
      background: linear-gradient(90deg, #4CAF50, #2c7a7b);
    }
    nav a {
      color: white !important;
      margin-right: 15px;
      font-weight: 500;
    }
        #chartContainer {
      width: 80%;
      max-width: 800px;
      margin: 50px auto;
    }

    nav a:hover {
      text-decoration: underline;
    }
    .hero {
      background: url("/static/uploads/hero.jpg") no-repeat center center/cover;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    }
    .card-hover:hover {
      transform: scale(1.03);
      transition: 0.3s;
      box-shadow: 0px 4px 20px rgba(0,0,0,0.2);
    }
 .full-footer {
  background: #2c7a7b;
  color: black;
  padding: 20px;
  text-align: center;
  width: 100%;
  margin: 0;
  box-sizing: border-box;
}

  #chart-container {
    width: 100%;
    max-width: 600px;
    margin: 50px auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }



  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ClearSpend</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#add">Add Expense</a></li>
        <li class="nav-item"><a class="nav-link" href="#expenses">All Expenses</a></li>
        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>

        {% if username %}
          <li class="nav-item"><a class="nav-link" href="/logout">Logout ({{username}})</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <h4 class="text-center mb-3">Login</h4>
      <form method="POST" action="/login">
        
        <div class="mb-3">
          <label>Username</label>
          <input type="text" name="username" class="form-control" required>
        </div>

        <div class="mb-3">
          <label>Password</label>
          <input type="password" name="password" class="form-control" required>
        </div>

        <button class="btn btn-success w-100">Login</button>
      </form>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, msg in messages %}
          <div class="alert alert-{{category}} mt-3">{{ msg }}</div>
        {% endfor %}
      {% endwith %}

      <p class="mt-3 text-center">
        Don‚Äôt have an account? 
        <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Register</a>
      </p>
    </div>
  </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <h4 class="text-center mb-3">Register</h4>
      <form method="POST" action="/register">
        
        <div class="mb-3">
          <label>First Name</label>
          <input type="text" name="first_name" class="form-control" required>
        </div>

        <div class="mb-3">
          <label>Last Name</label>
          <input type="text" name="last_name" class="form-control" required>
        </div>

        <div class="mb-3">
          <label>Username</label>
          <input type="text" name="username" class="form-control" required>
        </div>

        <div class="mb-3">
          <label>Password</label>
          <input type="password" name="password" class="form-control" required>
        </div>

        <div class="mb-3">
          <label>Confirm Password</label>
          <input type="password" name="confirm_password" class="form-control" required>
        </div>

        <button class="btn btn-primary w-100">Register</button>
      </form>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, msg in messages %}
          {% if category in ['success','danger'] %}
            <div class="alert alert-{{category}} mt-3">{{ msg }}</div>
          {% endif %}
        {% endfor %}
      {% endwith %}

      <p class="mt-3 text-center">
        Already have an account? 
        <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Login</a>
      </p>
    </div>
  </div>
</div>


<!-- Hero Section -->
<section id="home" class="hero">
  <div class="text-center ">
    <h1 class="display-3 fw-bold">Welcome, {{username}}</h1>
    <p class="lead">Track your expenses, manage your budget, and stay in control</p>
  </div>
</section>

<!-- Add Expense -->
<section id="add" class="container py-5">
  <h2 class="mb-4 text-center">Add Expense</h2>
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card card-hover p-4">
        <form method="POST" action="/add">
          <div class="mb-3">
            <label class="form-label">Title</label>
            <input type="text" name="title" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Amount</label>
            <input type="number" step="0.01" name="amount" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <input type="text" name="category" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-success w-100">Add Expense</button>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- All Expenses -->
<!-- All Expenses -->
<section id="expenses" class="container py-5">
  <h2 class="mb-4 text-center">All Expenses</h2>
  <div class="card card-hover p-4">

    <!-- Total Billing -->
    <h4 class="text-success">üí∞ Total Spent: ${{ total }}</h4>

    <table class="table table-striped table-hover mt-3">
      <thead>
        <tr>
          <th>Title</th>
          <th>Amount</th>
          <th>Category</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for exp in expenses %}
        <tr>
          <td>{{exp[1]}}</td>
          <td>${{exp[2]}}</td>
          <td>{{exp[3]}}</td>
          <td>{{exp[4]}}</td>
          <td><a href="/delete/{{exp[0]}}" class="btn btn-sm btn-danger">Delete</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


<!-- Expense Graph -->
<div id="chart-container">
    <canvas id="donutChart"></canvas>
</div>
<canvas id="monthlyChart"></canvas>

<!-- About -->
<section id="about" class="container py-5">
  <h2 class="mb-4 text-center">About This Project</h2>
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card card-hover p-4">
        <p>
          ClearSpend is your personal expense tracker built with Flask and PostgreSQL.  
          It allows you to log in, add expenses, view your spending history, and manage your budget ‚Äî 
          all in one professional dashboard.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="full-footer">
  <p>¬© 2025 ClearSpend | Built with ‚ù§Ô∏è by Laiba Abbasi</p>
</footer>

  

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Flask injects true/false here
    var loggedIn = {{ 'true' if username else 'false' }};
    
    if (!loggedIn) {
      var loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
      loginModal.show();
    }
  });
</script>
<script>
 
  const navLinks = document.querySelectorAll('.navbar-nav .nav-link[href^="#"]');

  navLinks.forEach(link => {
    link.addEventListener('mouseenter', () => { 
      const targetId = link.getAttribute('href').substring(1);
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
        targetSection.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('donutChart').getContext('2d');
const donutChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: {{ chart_data["labels"] | tojson }},
        datasets: [{
            data: {{ chart_data["values"] | tojson }},
            backgroundColor: {{ chart_data["colors"] | tojson }},
            borderWidth: 1
        }]
    },
    options: {
        plugins: {
            legend: {
                position: 'right',
                labels: {
                    color: 'black'
                }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        let label = context.label || '';
                        let value = context.raw || 0;
                        let total = context.dataset.data.reduce((a, b) => a + b, 0);
                        let percentage = ((value / total) * 100).toFixed(1) + '%';
                        return `${label}: $${value} (${percentage})`;
                    }
                }
            }
        },
        cutout: '60%',
    }
});
</script>

<script>
  const monthCtx = document.getElementById('monthlyChart').getContext('2d');
  const monthlyChart = new Chart(monthCtx, {
    type: 'bar', 
    data: {
      labels: {{ month_labels | tojson }},
      datasets: [{
        label: 'Total Spent ($)',
        data: {{ month_totals | tojson }},
        backgroundColor: 'rgba(54, 162, 235, 0.5)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      },
      plugins: {
        legend: {
          labels: {
            color: 'black'
          }
        }
      }
    }
  });
</script>

</body>
</html>

